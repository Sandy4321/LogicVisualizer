WARNING!!!
This code is non optimized and not structured. It has many repeating blocks of code.
